"use strict";var e=require("tslib"),t=require("react"),a=require("../common/ChartTooltip.cjs"),r=require("../../../lib/constants.cjs"),l=require("../../../lib/theme.cjs"),o=require("../../../lib/tremorTwMerge.cjs"),n=require("../../../lib/utils.cjs"),i=require("../common/NoData.cjs"),s=require("../../../assets/ArrowRightIcon.cjs");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=u(t);const c=10,m=["100%","75%","50%","25%","0%"],g=d.default.forwardRef(((t,u)=>{var g,f;const{data:h,evolutionGradient:x=!1,gradient:v=!0,valueFormatter:p=n.defaultValueFormatter,className:w,calculateFrom:b="first",color:y,variant:E="base",showGridLines:C=!0,showYAxis:T="previous"!==b,showXAxis:X=!0,showArrow:$=!0,yAxisPadding:M=(T?45:0),showTooltip:N=!0,onValueChange:H,customTooltip:k,noDataText:B,rotateLabelX:F,barGap:A="20%"}=t,z=e.__rest(t,["data","evolutionGradient","gradient","valueFormatter","className","calculateFrom","color","variant","showGridLines","showYAxis","showXAxis","showArrow","yAxisPadding","showTooltip","onValueChange","customTooltip","noDataText","rotateLabelX","barGap"]),Y=k,j=d.default.useRef(null),S=d.default.useRef(null),[q,L]=d.default.useState(0),[G,O]=d.default.useState(0),[P,R]=d.default.useState({x:0,y:0}),[V,I]=d.default.useState(void 0),D=!!H;const _=d.default.useMemo((()=>Math.max(...h.map((e=>e.value)))),[h]),W=q-20-M,K=d.default.useMemo((()=>{if("number"==typeof A)return A;if("string"==typeof A&&A.endsWith("%")){const e=parseFloat(A.slice(0,-1));return W*e/100/(h.length-1)}return console.error('Invalid barGap value. It must be a number or a percentage string (e.g., "10%").'),30}),[W,h.length,A]),J=d.default.useMemo((()=>(W-(h.length-1)*K-K)/h.length),[W,K,h.length]),Q=G-20-(X?((null==F?void 0:F.xAxisHeight)||15)+10:0),U="previous"===b,Z="center"===E;d.default.useLayoutEffect((()=>{const e=()=>{if(j.current){const e=j.current.getBoundingClientRect();L(e.width),O(e.height)}};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[w]),d.default.useEffect((()=>{const e=()=>{if(S.current){const e=S.current.getBoundingClientRect();e.right>window.innerWidth&&(S.current.style.left=q-e.width+"px")}};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[P,q]);const ee=d.default.useMemo((()=>Q<=0?[]:h.reduce(((e,t,a)=>{var r,l,o,n;const i=e[a-1],s=t.value,u=U&&null!==(r=null==i?void 0:i.value)&&void 0!==r?r:_,d=U&&null!==(l=null==i?void 0:i.barHeight)&&void 0!==l?l:Q,c=s/u,m=c*d,g=a*(J+K)+.5*K,f=d-m+(U?Q-(null!==(o=null==i?void 0:i.barHeight)&&void 0!==o?o:Q):0),x=null===(n=h[a+1])||void 0===n?void 0:n.value,v=x/u,p=v*d,w=(a+1)*(J+K)+.5*K;return e.push({value:s,normalizedValue:c,name:t.name,startX:g,startY:f,barHeight:m,nextValue:x,nextNormalizedValue:v,nextBarHeight:p,nextStartX:w}),e}),[])),[h,Q,U,J,K,_]),te=e=>{var t;const a=null===(t=j.current)||void 0===t?void 0:t.getBoundingClientRect();if(!a)return;const i=a.x,s=a.y+window.scrollY,u=i+window.scrollX+M+c,d=u+(a.width-M-c),m=s+(a.height-c-(X?15:0));if(e.pageX<u||e.pageX>d||e.pageY<s||e.pageY>m)return console.log("out of bounds"),R({x:0,y:0});const g=e.pageX-i-J/2-M-c,f=ee.reduce(((e,t)=>Math.abs(t.startX-g)<Math.abs(e.startX-g)?t:e)),h=ee.findIndex((e=>e===f));R({x:f.startX,y:f.startY,data:{dataKey:f.name,name:f.name,value:f.value,color:null!=y?y:r.BaseColors.Blue,className:o.tremorTwMerge(n.getColorClassNames(null!=y?y:r.BaseColors.Blue,l.colorPalette.text).textColor,D?"cursor-pointer":"cursor-default"),fill:"",payload:f},index:h})};return d.default.createElement("div",Object.assign({ref:u,className:o.tremorTwMerge("tremor-wrapper relative w-full h-80",w)},z),(null==h?void 0:h.length)?d.default.createElement(d.default.Fragment,null,d.default.createElement("svg",{ref:j,xmlns:"http://www.w3.org/2000/svg",className:o.tremorTwMerge("w-full h-full"),onMouseMove:e=>{const t={clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY};te(t)},onTouchMove:e=>{const t=e.touches[0];te(t)},onMouseLeave:()=>R({x:0,y:0}),onTouchEnd:()=>R({x:0,y:0})},m.map(((e,t)=>d.default.createElement(d.default.Fragment,{key:`y-axis-${t}`},C?d.default.createElement("line",{x1:M+c,y1:t*Q/4+c,x2:q-c,y2:t*Q/4+c,stroke:"currentColor",className:o.tremorTwMerge("stroke-1","stroke-tremor-border","dark:stroke-dark-tremor-border")}):null,d.default.createElement("text",{x:M-10+c,y:t*Q/4+5+c,textAnchor:"end",fill:"",stroke:"",className:o.tremorTwMerge("text-tremor-label","fill-tremor-content","dark:fill-dark-tremor-content")},e)))),ee.map(((e,t)=>{var a,i;return d.default.createElement("g",{key:`bar-${t}`},d.default.createElement("rect",{x:e.startX-.5*K+c+M,y:c,width:J+K,height:Q,fill:"currentColor",className:o.tremorTwMerge("z-0",P.index===t?"text-[#d1d5db]/15":"text-transparent")}),v?d.default.createElement("rect",{x:e.startX+c+M,y:Q-(U&&(null===(a=ee[t-1])||void 0===a?void 0:a.barHeight)||Q)+c,width:J,height:(Q-e.barHeight-(U&&Q-(null===(i=ee[t-1])||void 0===i?void 0:i.barHeight)||0))/(Z?2:1),fill:"url(#base-gradient)",className:o.tremorTwMerge(V&&V.index!==t?"opacity-30":"")}):null,d.default.createElement("rect",{x:e.startX+c+M,y:(Z?Q/2-e.barHeight/2:e.startY)+c,width:J,height:e.barHeight,fill:"currentColor",className:o.tremorTwMerge(n.getColorClassNames(null!=y?y:r.BaseColors.Blue,l.colorPalette.text).textColor,V&&V.index!==t?"opacity-30":"",D?"cursor-pointer":"cursor-default"),onClick:a=>function(e,t,a){a.stopPropagation(),D&&(t===(null==V?void 0:V.index)?(I(void 0),H(void 0)):(I({data:e,index:t}),H({eventType:"bar",categoryClicked:e.name,[e.name]:e.value,percentage:e.normalizedValue})))}(e,t,a)}),v&&Z?d.default.createElement("rect",{x:e.startX+c+M,y:Q/2+e.barHeight/2+c,width:J,height:(Q-e.barHeight)/2,fill:"url(#base-gradient-revert)",className:o.tremorTwMerge(V&&V.index!==t?"opacity-30":"")}):null,X?d.default.createElement("foreignObject",{x:e.startX+c+M,y:Q+c+10,width:J,height:(null==F?void 0:F.xAxisHeight)||15,transform:F?`rotate(${null==F?void 0:F.angle}, ${e.startX+J/2+c+M}, ${Q+((null==F?void 0:F.xAxisHeight)||15)/2+c+((null==F?void 0:F.verticalShift)||0)})`:void 0},d.default.createElement("div",{className:o.tremorTwMerge("truncate text-center !text-tremor-label","text-tremor-content","dark:text-dark-tremor-content"),title:e.name},e.name)):null)})),ee.map(((e,t)=>d.default.createElement(d.default.Fragment,{key:`gradient-${t}`},t<h.length-1&&x?d.default.createElement(d.default.Fragment,null,Z?d.default.createElement(d.default.Fragment,null,d.default.createElement("polygon",{points:`\n                                    ${e.startX+J+c+M}, ${Q/2+e.nextBarHeight/4+c}\n                                    ${e.nextStartX+c+M}, ${Q/2+e.nextBarHeight/4+c}\n                                    ${e.nextStartX+c+M}, ${Q/2-e.nextBarHeight/2+c}\n                                    ${e.startX+J+c+M}, ${Q/2-e.barHeight/2+c}\n                                  `,fill:"url(#base-gradient)",className:o.tremorTwMerge("z-10",V&&V.index!==t?"opacity-30":"")}),d.default.createElement("polygon",{points:`\n                                    ${e.startX+J+c+M}, ${Q/2+e.barHeight/2+c}\n                                    ${e.nextStartX+c+M}, ${Q/2+e.nextBarHeight/2+c}\n                                    ${e.nextStartX+c+M}, ${Q/2-e.nextBarHeight/4+c}\n                                    ${e.startX+J+c+M}, ${Q/2-e.nextBarHeight/4+c}\n                                  `,fill:"url(#base-gradient-revert)",className:o.tremorTwMerge("z-10",V&&V.index!==t?"opacity-30":"")})):d.default.createElement("polygon",{points:`\n                                  ${e.startX+J+c+M}, ${e.startY+c} \n                                  ${e.nextStartX+c+M}, ${Q-e.nextBarHeight+c} \n                                  ${e.nextStartX+c+M}, ${Q+c} \n                                  ${e.startX+J+c+M}, ${Q+c}\n                                `,fill:"url(#base-gradient)",className:o.tremorTwMerge("z-10",V&&V.index!==t?"opacity-30":"")})):null,t<h.length-1&&X&&$&&K>=14?d.default.createElement("foreignObject",{x:e.startX+J+c+M-6+K/2,y:Q+c+11,width:12,height:(null==F?void 0:F.xAxisHeight)||15},d.default.createElement("div",{className:o.tremorTwMerge("text-tremor-content","dark:text-dark-tremor-content")},d.default.createElement(s,{className:"size-3.5 shrink-0"}))):null))),d.default.createElement("linearGradient",{id:"base-gradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",className:o.tremorTwMerge(n.getColorClassNames(null!=y?y:r.BaseColors.Blue,l.colorPalette.text).textColor)},d.default.createElement("stop",{offset:"5%",stopColor:"currentColor",stopOpacity:.4}),d.default.createElement("stop",{offset:"95%",stopColor:"currentColor",stopOpacity:0})),d.default.createElement("linearGradient",{id:"base-gradient-revert",x1:"0%",y1:"0%",x2:"0%",y2:"100%",className:o.tremorTwMerge(n.getColorClassNames(null!=y?y:r.BaseColors.Blue,l.colorPalette.text).textColor)},d.default.createElement("stop",{offset:"5%",stopColor:"currentColor",stopOpacity:0}),d.default.createElement("stop",{offset:"95%",stopColor:"currentColor",stopOpacity:.4}))),N?d.default.createElement("div",{ref:S,className:o.tremorTwMerge("absolute top-0 pointer-events-none",P.data?"visible":"hidden"),tabIndex:-1,role:"dialog",style:{left:P.x+.66*J}},Y?d.default.createElement(Y,{payload:P.data?[P.data]:[],active:!!P.data,label:null===(g=P.data)||void 0===g?void 0:g.name}):d.default.createElement(a.ChartTooltipFrame,null,d.default.createElement("div",{className:o.tremorTwMerge("border-tremor-border border-b px-4 py-2","dark:border-dark-tremor-border")},d.default.createElement("p",{className:o.tremorTwMerge("font-medium","text-tremor-content-emphasis","dark:text-dark-tremor-content-emphasis")},null===(f=null==P?void 0:P.data)||void 0===f?void 0:f.name)),d.default.createElement("div",{className:o.tremorTwMerge("px-4 py-2 space-y-1")},P.data?d.default.createElement(a.ChartTooltipRow,{value:p(P.data.value),name:`${(100*P.data.payload.normalizedValue).toFixed(2)}%`,color:null!=y?y:r.BaseColors.Blue}):null))):null):d.default.createElement(i,{noDataText:B}))}));g.displayName="FunnelChart";module.exports=t=>{var{data:a}=t,r=e.__rest(t,["data"]);const l=a?((e,t)=>{if(e&&e.length>0){if("previous"===t&&e[0].value<=0)return`The value of the first item "${e[0].name}" is not greater than 0. This is not allowed when setting the "calculateFrom" prop to "previous". Please enter a value greater than 0.`;for(const t of e)if(t.value<0)return`Item "${t.name}" has a negative value: ${t.value}. This is not allowed. The value must be greater than or equal to 0.`}return null})(a,r.calculateFrom):null;return l?d.default.createElement(i,{className:"h-full w-full p-6",noDataText:`Calculation error: ${l}`}):d.default.createElement(g,Object.assign({data:a},r))};
